---
title: "COMPSCIX 415.2 Homework 4"
author: "Lian Shen"
date: "February 19, 2019"
output: 
  html_document:
    self_contained: true
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.align = 'center')
```
```{r}
library(tidyverse)
library(nycflights13)
```
***
##**5.6.7 Exercises**
###**2.**  
**Come up with another approach that will give you the same output as `not_cancelled %>% count(dest)` and `not_cancelled %>% count(tailnum, wt = distance)` (without using `count()`).**

```{r}
not_cancelled <- flights %>% filter(!is.na(dep_delay), !is.na(arr_delay))
#number of not_cancelled flights instances by dest
#not_cancelled %>% count(dest)
not_cancelled %>% group_by(dest) %>% summarize(n = n())
#total distance each not_cancelled flight flew by tailnum
#not_cancelled %>% count(tailnum, wt = distance)
not_cancelled %>% group_by(tailnum) %>% summarize(n = sum(distance))
```

***
###**4.**  
**Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?**

```{r}
cancelled <- flights %>% filter(is.na(dep_delay) & is.na(arr_delay))
#number of cancelled flights per day
cancelled_freq <- cancelled %>% group_by(year, month, day) %>% summarize(n = n()) %>% mutate(date = ISOdate(year, month, day))
cancelled_freq %>% ggplot(aes(x = date, y = n)) + geom_col() + xlab("Date") + ylab("Number of cancelled flights") + ggtitle("Frequency of Cancelled Flights per Day")
#proportion of cancelled flights per day
cancelled_prop <- flights %>% group_by(year, month, day) %>% summarize(cancelled_proportion = mean(is.na(dep_delay) & is.na(arr_delay))) %>% mutate(date = ISOdate(year, month, day))
cancelled_prop %>% ggplot(aes(x = date, y = cancelled_proportion)) + geom_col() + xlab("Date") + ylab("Proportion of cancelled flights") + ggtitle("Proportion of Cancelled Flights per Day")
#average delay per day
delays <- flights %>% group_by(year, month, day) %>% summarize(average_delay = mean(arr_delay, na.rm = TRUE) + mean(dep_delay, na.rm = TRUE)) %>% mutate(date = ISOdate(year, month, day))
delays %>% ggplot(aes(x = date, y = average_delay)) + geom_jitter() + geom_smooth(se = FALSE) + xlab("Date") + ylab("Average delay (min)") + ggtitle("Average Flight Delay per Day")
#proportion of cancelled flights to average delay
delayed_flights <- flights %>% group_by(year, month, day) %>% summarize(proportion = sum(is.na(dep_delay) & is.na(arr_delay))/n(), average_delay = mean(arr_delay, na.rm = TRUE) + mean(dep_delay, na.rm = TRUE)) %>% mutate(date = ISOdate(year, month, day))
delayed_flights %>% ggplot() + geom_jitter(aes(x = date, y = proportion), color = "blue")#+ geom_smooth(aes(x = date, y = average_delay), color = "red") + coord_cartesian()
```


***
###**6.**  
**What does the `sort` argument to `count()` do. When might you use it?**
```{r}
not_cancelled %>% count(dest, sort = TRUE)
```

The `sort` argument will order the output of `count()`, which is `n`, in descending order if set to `TRUE`. This could be useful when the user wants to check to see if he/she should filter the data first to remove any low counts of observations that may skew the data or if the user wants to check of the number of observations is sufficiently high enough.

***
###**5.**
**Which carrier has the worst delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about `flights %>% group_by(carrier, dest) %>% summarise(n())`)**
```{r}
#origin = airport
```


***
##**10.5 Exercises**
###**1.**
**How can you tell if an object is a tibble? (Hint: try printing `mtcars`, which is a regular data frame).**

```{r}
class(mtcars)
```
An object is a tibble if `[1] "tbl_df"     "tbl"        "data.frame"` is returned when `class(object)` is called. An object is a data frame when `[1] "data.frame"` is returned.

***
###**2.**
**Compare and contrast the following operations on a `data.frame` and equivalent tibble. What is different? Why might the default data frame behaviours cause you frustration?**  
**`df <- data.frame(abc = 1, xyz = "a")`**  
**`df$x`**  
**`df[, "xyz"]`**  
**`df[, c("abc", "xyz")]`**  



***
###**3.**
**If you have the name of a variable stored in an object, e.g. `var <- "mpg"`, how can you extract the reference variable from a tibble?**

***
###**6.**
**What option controls how many additional column names are printed at the footer of a tibble?**

***
##**12.3.3 Exercises**
###**2.**
**Why does this code fail?**  
**`table4a %>% gather(1999, 2000, key = "year", value = "cases")`**  
**`#> Error in inds_combine(.vars, ind_list): Position must be between 0 and n`**  

***
###**3.**
**Why does spreading this tibble fail? How could you add a new column to fix the problem?**  
**`people <- tribble(`**  
**`  ~name,             ~key,    ~value,`**  
**`  #-----------------|--------|------`**  
**`  "Phillip Woods",   "age",       45,`**  
**`  "Phillip Woods",   "height",   186,`**  
**`  "Phillip Woods",   "age",       50,`**  
**`  "Jessica Cordero", "age",       37,`**  
**`  "Jessica Cordero", "height",   156`**  
**`)`**

***
###**4.**
**Tidy the simple tibble below. Do you need to spread or gather it? What are the variables?**  
**`preg <- tribble(`**  
**`  ~pregnant, ~male, ~female,`**  
**`  "yes",     NA,    10,`**  
**`  "no",      20,    12`**  
**`)`**  

***
##**12.4.3 Exercises**
###**1.**
**What do the extra and fill arguments do in `separate()`? Experiment with the various options for the following two toy datasets.**  
```{r}
tibble(x = c("a,b,c", "d,e,f,g", "h,i,j")) %>% 
  separate(x, c("one", "two", "three"))

tibble(x = c("a,b,c", "d,e", "f,g,i")) %>% 
  separate(x, c("one", "two", "three"))
```
***
###**2.**
**Both `unite()` and `separate()` have a remove argument. What does it do? Why would you set it to `FALSE`?**  

***
##**Follow these steps:**  
**- Download the baby_names.txt file from Canvas which is in the Homework 4 assignment section.**  
**- Load this file into R correctly and take a glimpse of the output.**  
**- Export this file as a csv file and call it ‘baby_names.csv’.**  
**- Reload the baby_names.csv file and take another glimpse.**  
**- Show all of your code and the output. There should be two data import lines of code, one data export line of code, and two glimpses of the data.**  
